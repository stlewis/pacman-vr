<html>
  <head>
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/stlewis/aframe-extras/master/dist/aframe-extras.min.js"></script>
    <!--<script src='./aframe-extras.js'></script>-->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.1.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-template-component@^3.2.1/dist/aframe-template-component.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-gif-component/master/dist/aframe-gif-component.min.js"></script>
    <script src='https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js'></script>
    <script src="https://unpkg.com/aframe-fps-counter-component@^1.0.1/dist/aframe-fps-counter-component.min.js"></script>

    <script src='./systems/pac-maze.js'></script>

    <script src='./components/teleportable.js' charset="utf-8"></script>
    <script src='./components/pac-man.js' charset="utf-8"></script>
    <script src='./components/dot.js' charset="utf-8"></script>
    <script src='./components/scoreboard.js' charset="utf-8"></script>
    <script src='./components/camera-lock.js' charset="utf-8"></script>
    <script src='./components/behaviors/blinky-behavior.js'></script>
    <script src='./components/behaviors/pinky-behavior.js'></script>
    <script src='./components/behaviors/inky-behavior.js'></script>
    <script src='./components/behaviors/clyde-behavior.js'></script>

    <script src='./primitives/pac-dot.js' charset="utf-8"></script>

  </head>
  <body>
    <a-scene visible='true' scoreboard pac-maze>
      <a-assets>
        <img id='sky' src='./images/sky.jpg'>
        <img id='portal' src='./images/portal.gif'>
        <a-asset-item id='navmesh' src='./gltf/navmesh.gltf'>
        <a-asset-item id='blinky' src='./gltf/blinky.gltf'>
        <a-asset-item id='pinky' src='./gltf/pinky.gltf'>
        <a-asset-item id='inky' src='./gltf/inky.gltf'>
        <a-asset-item id='clyde' src='./gltf/clyde.gltf'>

        <a-mixin id='wall'
                 material='color: blue; roughness: 0.7; metalness: 0.2;'
                 geometry='height: 0.25;'>
          <a-mixin id='ghost-dims' scale='0.12 0.12 0.12'><a-mixin>
          <a-mixin id='ghost-behavior' nav-agent='speed: 1.5;'></a-mixin>
      </a-assets>
      <a-sky src='#sky'></a-sky>

      <!-- Portals -->
      <a-entity id='left-portal' geometry="primitive: plane; height: 4; width: 2;"
                                 position='-30 1.6 28'
                                 rotation='0 180 0'
                                 material='shader:gif; src: url(./images/portal.gif)'></a-entity>

      <a-entity id='left-portal' geometry="primitive: plane; height: 4; width: 2;"
                                 position='-30 1.6 -26'
                                 rotation='0 0 0'
                                 material='shader:gif; src: url(./images/portal.gif)'></a-entity>

       <!--Scoreboards-->
       <!-- Top  -->
       <a-gui-flex-container
                             id='top-score'
                             position='-62. 5.528 3.453'
                             rotation='0 90 0'>
         <a-text width='40' value="Score: "><a-text>
         <a-text class='scorevalue' width='40' value="0" position='5.2 0 0 '><a-text>
       </a-gui-flex-container>

       <!-- Bottom -->
       <a-gui-flex-container
                             id='bottom-score'
                             position='2.386 5.528 0.945'
                             rotation='0 -90 0'>
         <a-text width='40' value="Score: "><a-text>
         <a-text class='scorevalue' width='40' value="0" position='5.2 0 0 '><a-text>
       </a-gui-flex-container>

       <!-- Left -->
       <a-gui-flex-container
                             id='left-score'
                             position='-27.7 5.528 31.44'
                             rotation='0 180 0'>
         <a-text width='40' value="Score: "><a-text>
         <a-text class='scorevalue' width='40' value="0" position='5.2 0 0 '><a-text>
       </a-gui-flex-container>

       <!-- Right -->
       <a-gui-flex-container
                             id='right-score'
                             position='-33.2 5.528 -28.44'
                             rotation='0 0 0'>
         <a-text width='40' value="Score: "><a-text>
         <a-text class='scorevalue' width='40' value="0" position='5.2 0 0 '><a-text>
       </a-gui-flex-container>


      <a-gltf-model id='nav-mesh' nav-mesh src='#navmesh' position='0 0.1 0' visible='false'></a-gltf-model>
      <a-plane id='ground' height='100' width='100' material="color: black; metalness: 0.9;" rotation='-90 0 0' position='-29 0 -0.45'></a-plane>
      <!--Player-->

      <a-entity id="rig"
        teleportable
        movement-controls="speed: 0.1; constrainToNavMesh: true;"
        position="-23.9 0 0.739">


        <a-entity gearvr-controls>
          <a-entity fps-counter></a-entity>
        </a-entity>

        <a-entity camera
                  pac-man
                  id='camera'
                  sphere-collider='objects: a-pac-dot; radius: 1;'
                  geometry='primitive: sphere;'
                  look-controls
                  position="0 1.6 0">

          <a-entity id='score-wrapper' visible='false'>
            <a-gui-flex-container panel-color='#666666;' opacity='0.5'  position='0 0.25 -1.5' width='0.5' height='0.5' rotation='-35 0 0'>
              <a-text value='Score:' anchor='left' width='1.5' position='-0.25 0 0'></a-text>
              <a-text id='score' value='0' anchor='left' width='1.5' position='-0.025 0 0'></a-text>
            </a-gui-flex-container>
          </a-entity>

        </a-entity>
      </a-entity>

      <!-- One "ghost" -->
      <a-entity
        id='blinky-ghost'
        mixin='ghost-behavior'
        blinky-behavior='targetEntity: #rig; initializationDotCount: 1000'
        starting-position='-35.5 2.5 1.133'
        sphere-collider='objects: #camera; radius: 1;'
        geometry='primitive: box; height: 1; width: 1; depth: 1;'
        material="transparent: true; opacity: 1; color: red;"
        position='-35.5 0 1.133'>
          <!--<a-gltf-model src='#blinky'-->
                        <!--position='0 1.6 0'-->
                        <!--mixin='ghost-dims'-->
                        <!--></a-gltf-model>-->
      </a-entity>

      <a-entity
        id='inky-ghost'
        mixin='ghost-behavior'
        inky-behavior='targetEntity: #rig; initializationDotCount: 10000'
        sphere-collider='objects: #camera; radius: 1;'
        starting-position='-29.7 2.5 4.754'
        geometry='primitive: box; height: 1; width: 1; depth: 1;'
        material="transparent: true; opacity: 1; color: aqua;"
        position='-29.7 1.6 4.754'>
          <!--<a-gltf-model src='#inky'-->
                        <!--position='0 1.6 0'-->
                        <!--mixin='ghost-dims'-->
                        <!--></a-gltf-model>-->
      </a-entity>

      <a-entity
        id='pinky-ghost'
        mixin='ghost-behavior'
        pinky-behavior='targetEntity: #rig; initializationDotCount: 100'
        sphere-collider='objects: #camera; radius: 1;'
        starting-position='-29.7 2.5 0.817'
        geometry='primitive: box; height: 1; width: 1; depth: 1;'
        material="transparent: true; opacity: 1; color: pink;"
        position='-29.7 2.5 0.817'>
          <!--<a-gltf-model src='#pinky'-->
                        <!--position='0 1.6 0'-->
                        <!--mixin='ghost-dims'-->
                        <!--></a-gltf-model>-->
      </a-entity>

      <a-entity
        id='clyde-ghost'
        mixin='ghost-behavior'
        clyde-behavior='targetEntity: #rig; initializationDotCount: 0'
        sphere-collider='objects: #camera; radius: 1;'
        starting-position='-29.7 2.5 -2.99'
        geometry='primitive: box; height: 1; width: 1; depth: 1;'
        material="transparent: true; opacity: 1; color: orange;"
        position='-29.7 2.5 -2.99'>
          <!--<a-gltf-model src='#clyde'-->
                        <!--position='0 1.6 0'-->
                        <!--mixin='ghost-dims'-->
                        <!--></a-gltf-model>-->
      </a-entity>


      <!--Maze -->
      <a-entity id='maze' rotation='0 90 0' template='src: ./templates/maze.html'><a-entity>




    </a-scene>
  </body>
</html>
